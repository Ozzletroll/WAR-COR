{% import "components/timeline/epoch.html" as epoch %}
{% import "components/timeline/day.html" as timeline_day %}

{# 
  MONTH COMPONENT

  Placed dynamically on the timeline

  Takes the campaign object, year object, jinja2 loop.length,
  jinja2 index0, and a boolean value to toggle edit page
  elements.
#}

{% macro month(campaign, year, month, length, index, edit=false) %}

  <!-- Month {{ month.name }} -->

  {% if not month.has_events %}
    {% set hidden_class = "hidden" %}
    {% set hidden_mobile_class = "hidden-mobile" %}
  {% endif %}

  {% if index == 0 %}
    <div class="month-outer month-outer-top">
  {% elif index == length - 1 %}
    <div class="month-outer month-outer-bottom">
  {% else %}
    <div class="month-outer">
  {% endif %}

  {% if month.days | length != 0 %}

    {% if month.epoch_offset %}
    <div class="month-connector month-connector-offset {{ hidden_mobile_class }}">
    {% else %}
    <div class="month-connector {{ hidden_mobile_class }}">
    {% endif %}

      <div class="line line-first"></div>
      <div class="connector-date connector-date-outline">
        <div class="connector-date">
          {{ month.name }}
        </div>
      </div>
      <div class="line"></div>
    </div>

  {% endif %}

  <div class="timeline-month">

    {% for day in month.days %}

      {% if edit %}
        {{ timeline_day.day(campaign,
                            year,
                            month,
                            day,
                            length=loop.length,
                            index=loop.index0,
                            edit=true) }}
      {% else %}
        {{ timeline_day.day(campaign,
                            year,
                            month,
                            day,
                            length=loop.length,
                            index=loop.index0) }}
      {% endif %}

    {% endfor %}

  </div>

  </div>


  {% if edit %}
    {% if not month.has_following_month %}
    <!-- End of month new event button -->
    <div class="month-between event-between-years">
      <div class="between-months-elements">
        <div class="line line-dashed line-dashed-heavy"></div>
      </div>
      <a href="{{ url_for('event.add_event', 
                            campaign_name=campaign.url_title,
                            new_month=True, 
                            campaign_id=campaign.id,
                            elem_id='new-month-event-' + year.name + '-' + month.name,
                            date=year.name + '/' + month.name + '/' + '01' + ' 00:00:00') }}">
        <button id="new-month-event-{{year.name}}-{{month.name}}" class="new-timeline-item">
          <img class="icon icon-invert" src="{{ url_for('static', filename='/images/icons/plus.svg') }}">
        </button>
      </a>
      <p class="flavour-text new-event-flavour">//NEW EVENT: +1 Month</p>
    </div>
    {% endif %}

  {% endif %}

{%- endmacro %}
