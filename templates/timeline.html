{% extends "base/base.html" %}

{% block content %}

<div class="sidebar-page">
  {% include "base/sidebar.html" %}

  <div class="scrollpage">

    <div class="campaigns-content">

      <div class="navigation-area">
        <a href="{{url_for('campaign.campaigns')}}" class="navigation-url">
          <h5 class="navigation-heading">/CAMPAIGNS/</h5>
        </a>
      </div>

      <div class="campaigns-title">
        <h3 class="campaigns-heading">{{campaign.title}}</h1>
      </div>

      <hr class="campaigns-divider">
      <p class="flavour-text timeline-margin">UWC-21-{{campaign.id}} // Campaign::Timeline</p>

      <!-- Overview and members list -->
      <div class="campaign-entry-container timeline-overview">
        <div class="campaign-overview">
          <h4 class="campaign-entry-title">Overview:</h4>
          <p>{{ campaign.description }}</p>
        </div>
        <div class="campaign-members">
          <h4 class="campaign-entry-title">Members:</h2>
          <ul class="campaign-members-list">
            {% for user in campaign.members %}
              {% if campaign in user.permissions %}
              <li class="members-list-admin">
                <img class="icon icon-invert" src="/static/images/icons/admin.svg">
                {% else %}
              <li class="members-list-item">
                <img class="icon icon-invert" src="/static/images/icons/user.svg">
              {% endif %}
                <h6 class="callsign-text">
                  {{user.username.upper()}}:
                </h6>
                {% for entry in user.campaign_associations %}
                  {%if entry.campaign_id == campaign.id%}
                    {% if entry.callsign is not none %}
                      <h6 class="callsign-text">
                        [{{entry.callsign.upper()}}]
                      </h6>
                    {% endif %}
                  {%endif%}
                {% endfor %}
                {% if campaign in user.permissions %}
                [ADMIN]
                {% endif %}
              </li> 
            {% endfor %} 
          </ul>
        </div> 
      </div>

      <!-- Placeholder add event button -->
      {% if campaign in current_user.permissions %}
      <a href="{{ url_for('event.add_event', campaign_name=campaign.title, campaign_id=campaign.id) }}">
        <button>
          ADD EVENT
        </button>
      </a>
      {% endif %}


      <!-- Timeline -->
      <div class="timeline-container">

        {% for year in timeline_data %}

        <div class="timeline-year">

          <div class="timeline-year-container">
            <h3 class="timeline-year-header" id="year-{{year}}">
            {{ year + "u"}}
            </h3> 
            <hr class="timeline-horizontal">
            <hr class="timeline-line">
            <hr class="timeline-horizontal">
          </div>

          <div class="timeline-months-container">

            {% for month in timeline_data[year] %}

            <div class="month-outer">

              <div class="month-connector">
                <div class="line"></div>
                <div class="connector-date">
                  {{ month }}
                </div>
                <div class="line"></div>

              </div>

              <div class="timeline-month">
                
                {% for event in timeline_data[year][month] %}

                  {% if loop.length == 1 %}
                  <div class="timeline-event-container">
                  <div class="event-line event-line-solo"></div>
                  {% elif loop.first  %}
                  <div class="timeline-event-container">
                  <div class="event-line event-line-top"></div>
                  {% elif loop.last %}
                  <div class="timeline-event-container event-container-bottom">
                  <div class="event-line event-line-bottom"></div>
                  {% else %}
                  <div class="timeline-event-container event-container-mid">
                  <div class="event-line event-line-mid"></div>
                  {% endif %}

                    <div id="event-{{event.id}}" class="timeline-event">
                      <div class="event-header">
                        //{{ event.title }}
                      </div>
                      <div class="event-body">
                        <p class="event-date">{{event.date[:-8]}}</p>
                        <p class="event-date">{{event.date[-8:]}}</p>
                        <p class="event-description">
                          {{event.body[:180]}}
                          {% if event.body|length > 180 %}
                            ...
                          {% endif %}
                        </p>
                        <div class="event-button-area">
                          <a href=""><button class="entry-button">VIEW</button></a>
                        </div>
                      </div>

                    </div>

                  </div>

                {% endfor %}

              </div>

           </div>
            {% endfor %}
          </div>

        </div>
        
        {% endfor %}

      </div>


    </div>

  </div>

</div>

{% endblock %}