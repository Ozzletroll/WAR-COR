{% extends "base/base.html" %}

{% block content %}

<div class="scrollpage">

  <div class="campaigns-content">
    
    <div class="campaigns-title">
      <h3 class="campaigns-heading heading-top">Campaigns</h1>
    </div>

    <hr class="campaigns-divider">
    <p class="flavour-text">UWC-7-01 // Personnel::Service Record </p>

    <div class="form-flash">
      {% include 'base/flash.html' %}
    </div>

    <ul class="campaigns-list">

      {% for campaign in campaigns %}
        <section class="campaign-entry">

          <h2 id="campaign-{{ campaign.id }}" class="campaign-header">{{ campaign.title }}</h2>

          <div class="campaign-body">

            <p class="flavour-text">UCR-{{current_user.id}}-{{campaign.id}} // Campaign::Dossier </p>

            <div class="campaign-entry-container">
              <div class="campaign-overview">
                <h4 class="campaign-entry-title">Overview:</h4>
                {{ campaign.description | safe }}
              </div>
              <div class="campaign-members">
                <h4 class="campaign-entry-title">Members:</h2>
                

                  {#
                  {% for user in campaign.members %}
                    {% if campaign in user.permissions %}
                    <li class="members-list-item members-list-admin">
                      <img class="icon icon-invert" src="/static/images/icons/admin.svg">
                      {% else %}
                    <li class="members-list-item">
                      <img class="icon icon-invert" src="/static/images/icons/user.svg">
                    {% endif %}
                    <h6 class="callsign-text callsign-username">
                    {{user.username.upper()}}:
                    </h6 class="callsign-text">
                      {% for entry in user.campaign_associations %}
                        {%if entry.campaign_id == campaign.id%}
                          {% if entry.callsign is not none %}
                            <h6 class="callsign-text callsign-break">
                              [{{entry.callsign.upper()}}]
                            </h6>
                          {% endif %}
                        {%endif%}
                      {% endfor %}
                      {% if campaign in user.permissions %}
                      <h6 class="callsign-text admin-tag">[WARCOR]</h6>
                      {% else %}
                      <h6 class="callsign-text admin-tag admin-tag-blank"></h6>
                      {% endif %}
                    </li> 
                  {% endfor %} 
                  #}

                  <div class="campaign-members-list">

                    <table>
                      {% for user in campaign.members %}
                        <tr class="table-row">
                          <th class="table-cell">
                            <div class="username-cell">
                              {% if campaign in user.permissions %}
                                <img class="icon icon-invert" src="/static/images/icons/admin.svg">
                              {% else %}
                                <img class="icon icon-invert" src="/static/images/icons/user.svg">
                              {% endif %}
                              <h6 class="callsign-text callsign-username">
                              {{user.username.upper()}}:
                            </div>
                          </th>

                          <th class="table-cell">
                            {% for entry in user.campaign_associations %}
                              {%if entry.campaign_id == campaign.id%}
                                {% if entry.callsign is not none %}
                                  <h6 class="callsign-text callsign-break">
                                    [{{entry.callsign.upper()}}]
                                  </h6>
                                {% endif %}
                              {%endif%}
                            {% endfor %}
                          </th>


                          <th class="table-cell">
                            {% if campaign in user.permissions %}
                            <h6 class="callsign-text admin-tag">[WARCOR]</h6>
                            {% else %}
                            <h6 class="callsign-text admin-tag admin-tag-blank"></h6>
                            {% endif %}
                          </th>
                        </tr>
                      {% endfor %}

                    </table>

                  </div>

              </div> 
            </div>
          

            <div class="campaign-overview last-edited-area">
              <h4 class="campaign-entry-title">Last Updated:</h4>
              <p class="last-updated-text">{{ campaign.last_edited }}</p>
            </div>

            <div class="campaign-entry-buttons">
              
              <div class="entry-button-outline">
                <a href="{{ url_for('campaign.show_timeline', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                  <button class="entry-button">VIEW</button>
                </a>
              </div>

              {% if campaign in current_user.permissions %}
              
                <div class = "dropdown-area">

                  <div class="entry-button-outline">
                    <button id="button-{{campaign.id}}" class="entry-button edit-button">EDIT</button>
                  
                      <div id="dropdown-{{campaign.id}}" class="entry-buttons-deploy">
                        <a href="{{ url_for('campaign.edit_campaign', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                          <button class="deploy-button deploy-button-first">
                            <img class="icon icon-small icon-invert" src="/static/images/icons/edit.svg"> 
                            Title/Overview
                          </button>
                        </a>
                        <a href="{{ url_for('campaign.edit_timeline', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                          <button class="deploy-button">
                            <img class="icon icon-small icon-invert" src="/static/images/icons/docs.svg"> 
                            Event Data
                          </button>
                        </a>
                        <a href="{{ url_for('campaign.edit_campaign_users', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                          <button class="deploy-button">
                            <img class="icon icon-small icon-invert" src="/static/images/icons/user_management_dark.svg"> 
                            Members
                          </button>
                        </a>
                        <a href="{{ url_for('data.backup_page', campaign_name=campaign.title, campaign_id=campaign.id) }}">
                          <button class="deploy-button">
                            <img class="icon icon-small icon-invert" src="/static/images/icons/database.svg"> 
                            Data Backup
                          </button>
                        </a>
                        <a href="{{ url_for('campaign.delete_campaign', campaign_name=campaign.title, campaign_id=campaign.id) }}">
                          <button class="deploy-button deploy-button-last">
                            <img class="icon icon-small icon-invert" src="/static/images/icons/bin.svg"> 
                            Delete
                          </button>
                        </a>
                      </div>   

                    </div>
                </div>

              {% endif %}

              
            </div>
          </div>

        </section>
      {% endfor %}

      {# New user introduction, if user.campaigns is empty #}
      {% if not campaigns %}
        
      <section class="campaign-entry">

        <h2 class="campaign-header">Welcome, {{current_user.username}}</h2>

          <div class="campaign-body">

            <p class="flavour-text">UCR-{{current_user.id}}-00 // Correspondent::Briefing </p>

            <div class="campaign-overview campaign-list-empty">
              <h4 class="campaign-entry-title">Getting Started:</h4>
              <p>As a new UWC Correspondent, you can get started by reaching out to your GM for a campaign invitation, or by creating a new campaign with the button below.</p>
              <p>As a representative of the UWC, you stand on the frontlines of the battle for objective reporting in military conflict, but you do not stand alone. </p>
              <p>There is no limit to the number of active campaigns you can join or create, and there is no limit to the number of members you can invite.</p>
              <p>Good luck, Warcor.</p>

            </div>

      </section>

      {% endif %}

      <!-- New Campaign Button -->
      <a href="{{ url_for('campaign.create_campaign')}}" class="campaign-entry new-campaign-area">
        <span class="new-campaign-span">
        <h2 class="campaign-entry-title new-campaign-heading">New Campaign</h2>
        </span>
      </a>

    </ul>

  </div>
</div>

<!-- Javascript -->
<script src="/static/js/campaigns.js"></script> 

<!-- Scroll to target element if scroll_target is set -->
{% if scroll_target %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('{{ scroll_target }}').scrollIntoView();
  });
</script>

{% endif %}

{% endblock %}