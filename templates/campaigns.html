{# Component Macro imports #}
{% import "components/page_upper_area.html" as page_upper_area %}
{% import "components/members_list.html" as members_list %}
{% import "components/back_button.html" as back_button %}

{% extends "base/base.html" %}

{% block content %}

<div class="scrollpage">

  <div class="campaigns-content">
    
    {# Create navigation url bar #}

    {% set urls = [""] %}

    {{ page_upper_area.page_upper_area(navigation_urls=urls, 
                             is_link=false, 
                             searchbar=true,
                             current_user=current_user) }}

    <div class="campaigns-title">

      {# Blank back button area area. No url needed. #}
      {% set url = "" %}

      {{ back_button.back_button(url=url, blank=true) }}

      <h3 class="campaigns-heading">Campaigns</h1>
      <div class="view-toggles">

        <label class="toggle campaign-view-toggle view-toggle-left" for="campaign-toggle-list">
          <input class="radio radio-hidden" type="radio" id="campaign-toggle-list" name="view" value="HTML" checked>
          <svg class="icon" width="20px" height="20px" viewBox="0 0 24 24" fill="none">
            <path class="icon-colour-var" d="M3.5 20.5L3.5 13.5L20.5 13.5V20.5H3.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path class="icon-colour-var" d="M3.5 10.5L3.5 3.5L20.5 3.5V10.5L3.5 10.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </label>

        <label class="toggle campaign-view-toggle view-toggle-right" for="campaign-toggle-grid">
          <input class="radio radio-hidden" type="radio" id="campaign-toggle-grid" name="view" value="HTML">
          <svg class="icon" width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path class="icon-colour-var" d="M3.5 3.5H10.5V10.5H3.5V3.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path class="icon-colour-var" d="M3.5 13.5H10.5V20.5H3.5V13.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path class="icon-colour-var" d="M13.5 3.5H20.5V10.5H13.5V3.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path class="icon-colour-var" d="M13.5 13.5H20.5V20.5H13.5V13.5Z" stroke="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>       
        </label>

      </div>
    </div>

    <hr class="campaigns-divider">
    <p class="flavour-text">UWC-7-01 // Personnel::Service Record </p>

    <div class="form-flash">
      {% include 'base/flash.html' %}
    </div>

    <div id="campaigns-list" class="campaigns-list">

      {% for campaign in campaigns %}
        <section class="campaign-entry">

          <div class="campaign-header-section">
            <h2 id="campaign-{{ campaign.id }}" class="campaign-header">{{ campaign.title }}</h2>
            <div class="campaign-corner"></div>
          </div>



          <div class="campaign-body">

            <p class="flavour-text">UCR-{{current_user.id}}-{{campaign.id}} // Campaign::Dossier </p>

            <div class="campaign-entry-container">
              <div class="campaign-overview">
                <h4 class="campaign-entry-title">Overview:</h4>
                {{ campaign.description | safe }}
              </div>

                
              {# Members list #}
              {{ members_list.members_list(campaign) }}


            </div>
          

            <div class="campaign-overview last-edited-area">
              <h4 class="campaign-entry-title">Last Updated:</h4>
              <p class="last-updated-text">{{ campaign.last_edited }}</p>
            </div>

            <div class="campaign-entry-buttons">
              
              <div class="entry-button-outline">
                <a href="{{ url_for('campaign.show_timeline', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                  <button class="entry-button">VIEW</button>
                </a>
              </div>

              {% if campaign in current_user.permissions %}
              
                <div class="dropdown-area">

                  <div class="entry-button-outline">
                    <button id="button-{{campaign.id}}" class="entry-button edit-button">EDIT</button>
                  </div>
                  <div id="dropdown-{{campaign.id}}" class="entry-buttons-deploy">
                    <a href="{{ url_for('campaign.edit_campaign', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                      <button class="deploy-button deploy-button-first">
                        <img class="icon icon-small icon-invert" src="/static/images/icons/edit.svg"> 
                        Title/Overview
                      </button>
                    </a>
                    <a href="{{ url_for('campaign.edit_timeline', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                      <button class="deploy-button">
                        <img class="icon icon-small icon-invert" src="/static/images/icons/docs.svg"> 
                        Event Data
                      </button>
                    </a>
                    <a href="{{ url_for('campaign.edit_campaign_users', campaign_name=campaign.title, campaign_id=campaign.id)}}">
                      <button class="deploy-button">
                        <img class="icon icon-small icon-invert" src="/static/images/icons/user_management_dark.svg"> 
                        Members
                      </button>
                    </a>
                    <a href="{{ url_for('data.backup_page', campaign_name=campaign.title, campaign_id=campaign.id) }}">
                      <button class="deploy-button">
                        <img class="icon icon-small icon-invert" src="/static/images/icons/database.svg"> 
                        Data Backup
                      </button>
                    </a>
                    <a href="{{ url_for('campaign.delete_campaign', campaign_name=campaign.title, campaign_id=campaign.id) }}">
                      <button class="deploy-button deploy-button-last">
                        <img class="icon icon-small icon-invert" src="/static/images/icons/bin.svg"> 
                        Delete
                      </button>
                    </a>
                  </div>  
                </div>

              {% endif %}

              
            </div>
          </div>

        </section>
      {% endfor %}

      {# New user introduction, if user.campaigns is empty #}
      {% if not campaigns %}
        
      <section class="campaign-entry">

        <div class="campaign-header-section">
          <h2 class="campaign-header">Welcome, {{current_user.username}}</h2>
          <div class="campaign-corner"></div>
        </div>
        

          <div class="campaign-body">

            <p class="flavour-text">UCR-{{current_user.id}}-00 // Correspondent::Briefing </p>

            <div class="campaign-overview campaign-list-empty">
              <h4 class="campaign-entry-title">Getting Started:</h4>
              <p>As a new UWC Correspondent, you can get started by reaching out to your GM for a campaign invitation, or by creating a new campaign with the button below.</p>
              <p>
                You can view pending campaign invitations from the messages panel 
                
                <span class="nowrap">
                [
                  <svg class="icon icon-small icon-inline" width="15px" height="15px" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <title>mail</title>
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g class="icon-colour-text" id="email" fill="none" transform="translate(42.666667, 85.333333)">
                            <path d="M3.55271368e-14,1.42108547e-14 L3.55271368e-14,341.333333 L426.666667,341.333333 L426.666667,1.42108547e-14 L3.55271368e-14,1.42108547e-14 Z M349.226667,42.6666667 L213.333333,163.413333 L77.44,42.6666667 L349.226667,42.6666667 Z M42.6666667,298.666667 L42.6666667,68.9066667 L213.333333,220.586667 L384,68.9066667 L384,298.666667 L42.6666667,298.666667 Z"></path>
                          </g>
                      </g>
                  </svg>
                ]
                </span>
                at the top right of the screen.
              
              </p>
              <p>
                Once you have joined or created a campaign, you can set your callsign - a campaign specific identifier - 
                from the user page 
                
                <span class="nowrap">
                [
                <svg class="icon icon-small icon-inline" width="15px" height="15px" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <title>user</title>
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                      <g class="icon-colour-text" id="icon" fill="none" transform="translate(85.333333, 42.666667)">
                          <path d="M170.666667,170.666667 C217.794965,170.666667 256,132.461632 256,85.3333333 C256,38.2050347 217.794965,7.10542736e-15 170.666667,7.10542736e-15 C123.538368,7.10542736e-15 85.3333333,38.2050347 85.3333333,85.3333333 C85.3333333,132.461632 123.538368,170.666667 170.666667,170.666667 Z M170.666667,42.6666667 C194.230816,42.6666667 213.333333,61.769184 213.333333,85.3333333 C213.333333,108.897483 194.230816,128 170.666667,128 C147.102517,128 128,108.897483 128,85.3333333 C128,61.769184 147.102517,42.6666667 170.666667,42.6666667 Z M213.333333,213.333333 L128,213.333333 C57.307552,213.333333 1.42108547e-14,270.640885 1.42108547e-14,341.333333 L1.42108547e-14,426.666667 L341.333333,426.666667 L341.333333,341.333333 C341.333333,270.640885 284.025781,213.333333 213.333333,213.333333 Z M298.666667,384 L42.6666667,384 L42.6666667,341.333333 C42.6666667,294.205035 80.8717013,256 128,256 L213.333333,256 C260.461632,256 298.666667,294.205035 298.666667,341.333333 L298.666667,384 Z" id="user"></path>
                          </g>
                      </g>
                  </svg>
                ]
                </span>

              </p>

            </div>

      </section>

      {% endif %}

    </div>

    <!-- New Campaign Button -->
    <a href="{{ url_for('campaign.create_campaign')}}" class="campaign-entry new-campaign-area">
      <span class="new-campaign-span">
      <h2 class="campaign-entry-title new-campaign-heading">New Campaign</h2>
      </span>
    </a>

  </div>
</div>

<!-- Javascript -->
<script src="/static/js/campaigns.js"></script>
<script src="/static/js/campaigns_layout.js"></script>
<script src="/static/js/campaign_search.js"></script> 

<!-- Scroll to target element if scroll_target is set -->
{% if scroll_target %}
<script>
  window.addEventListener('load', function() {
    document.getElementById('{{ scroll_target }}').scrollIntoView();
  });
</script>

{% endif %}

{% endblock %}